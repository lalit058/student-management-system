{% extends 'hod_template/base_template.html' %}
{% block page_title %}
Manage Staff
{% endblock page_title %}
{% load static %}
{% block main_content %}
<!-- Main content -->
<section class="content">
  <div class="container-fluid">
    <!-- Message Display -->
    <div class="row">
      <div class="col-12">
        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        {% endfor %}
        {% endif %}
      </div>
    </div>
    <!-- End Message Display -->

    <div class="row">
      <div class="col-12">
        <div class="card card-primary card-outline">
          <div class="card-header bg-gradient-navy">
            <h3 class="card-title text-white">
              <i class="fas fa-chalkboard-teacher mr-2"></i>
              Staff Details
            </h3>
            <div class="card-tools">
              <div class="input-group input-group-sm" style="width: 250px;">
                <a href="{% url 'add_staff' %}" class="btn btn-sm btn-success mr-2">
                <i class="fas fa-plus"></i> Add Staff
              </a>
                <input type="text" name="table_search" class="form-control" placeholder="Search staff...">
                <div class="input-group-append">
                  <button type="submit" class="btn btn-light">
                    <i class="fas fa-search"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <!-- /.card-header -->
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="bg-lightblue">
                  <tr>
                    <th>ID</th>
                    <th>Profile</th>
                    <th>Name</th>
                    <th>Username</th>
                    <th>Gender</th>
                    <th>Qualification</th>
                    <th>Experience</th>
                    <th>Contact</th>
                    <th>Address</th>
                    <th>Status</th>
                    <th class="text-center">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for staff in staffs %}
                  <tr class="{% cycle 'bg-white' 'bg-gray-50' %}">
                    <td class="align-middle font-weight-bold text-primary">#{{ staff.admin.id }}</td>
                    <td class="align-middle">
                      <div class="d-flex align-items-center">
                        <div class="avatar-circle-sm mr-2">
                          {% if staff.profile_pic %}
                          <img src="{{ staff.profile_pic }}" class="img-circle" alt="Profile">
                          {% else %}
                          <img src="{% static 'dist/img/user2-160x160.jpg' %}" class="img-circle" alt="Default Profile">
                          {% endif %}
                        </div>
                      </div>
                    </td>
                    <td class="align-middle">
                      <div class="d-flex flex-column">
                        <span class="font-weight-bold">{{ staff.admin.first_name }} {{ staff.admin.last_name }}</span>
                        <small class="text-muted">{{ staff.admin.email }}</small>
                      </div>
                    </td>
                    <td class="align-middle">
                      <span class="badge badge-info">{{ staff.admin.username }}</span>
                    </td>
                    <td class="align-middle">{{ staff.gender }}</td>
                    <td class="align-middle">
                      {{ staff.qualification|default:"-" }}
                    </td>
                    <td class="align-middle">
                      {{ staff.years_of_experience|default:"0" }} years
                    </td>
                    <td class="align-middle">
                      <i class="fas fa-phone mr-1 text-muted"></i> {{ staff.phone_number|default:"-" }}
                    </td>
                    <td class="align-middle">
                      {{ staff.address|default:"-" }}
                    </td>
                    <td class="align-middle" style="min-width: 150px;">
                      <div class="d-flex flex-column">
                        <div class="mb-1">
                          <span
                            class="badge {% if staff.admin.is_active %}badge-success{% else %}badge-danger{% endif %}">
                            {% if staff.admin.is_active %}Active{% else %}Inactive{% endif %}
                          </span>
                        </div>
                        <div class="text-muted small">
                          <div><i class="fas fa-calendar-alt mr-1"></i> Joined: {{ staff.admin.date_joined|date:"Y-m-d" }}
                          </div>
                          <div style="color: #2a5298;">
                            <i class="fas fa-sign-in-alt mr-1"></i>Last login:{% if staff.admin.last_login %}{{ staff.admin.last_login|date:"Y-m-d H:i" }}
                            {% else %}Never{% endif %}
                          </div>
                        </div>
                      </div>
                    </td>
                    <td class="align-middle text-center">
                      <div class="btn-group" role="group">
                        <a href="{% url 'edit_staff' staff_id=staff.admin.id %}" class="btn btn-sm btn-outline-primary"
                          title="Edit" data-toggle="tooltip">
                          <i class="fas fa-edit"></i>
                        </a>
                        <button class="btn btn-sm btn-outline-danger" data-toggle="modal"
                          data-target="#deleteModal{{ staff.admin.id }}" title="Delete" data-toggle="tooltip">
                          <i class="fas fa-trash"></i>
                        </button>
                        <a href="{% url 'staff_profile_view' staff_id=staff.admin.id %}"
                          class="btn btn-sm btn-outline-info" title="View Profile" data-toggle="tooltip">
                          <i class="fas fa-eye"></i>
                        </a>
                      </div>
                    </td>
                  </tr>

                  <!-- Delete Modal for each staff -->
                  <div class="modal fade" id="deleteModal{{ staff.admin.id }}" tabindex="-1" role="dialog"
                    aria-labelledby="deleteModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                      <div class="modal-content">
                        <div class="modal-header bg-danger text-white">
                          <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                          <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                          <div class="text-center mb-4">
                            {% if staff.profile_pic %}
                            <img src="{{ staff.profile_pic }}" class="img-circle elevation-2" width="100" height="100"
                              alt="Profile">
                            {% else %}
                            <img src="{% static 'dist/img/user2-160x160.jpg' %}" class="img-circle elevation-2"
                              width="100" height="100" alt="Default Profile">
                            {% endif %}
                            <h5 class="mt-3">{{ staff.admin.first_name }} {{ staff.admin.last_name }}</h5>
                            <p class="text-muted">{{ staff.admin.email }}</p>
                            <div class="text-left mt-3">
                              <p><strong>Address:</strong> {{ staff.address|default:"Not specified" }}</p>
                              <p><strong>Joined:</strong> {{ staff.joining_date|date:"F j, Y" }}</p>
                            </div>
                          </div>
                          <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            <strong>Warning:</strong> This action cannot be undone. All associated data will be
                            permanently deleted.
                          </div>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                          <form method="POST" action="{% url 'delete_staff' staff_id=staff.admin.id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger">
                              <i class="fas fa-trash mr-1"></i> Delete Permanently
                            </button>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
          <!-- /.card-body -->
          <div class="card-footer bg-white">
            <div class="d-flex justify-content-between align-items-center">
              <div class="text-muted">
                Showing <strong>{{ staffs.start_index }}</strong> to <strong>{{ staffs.end_index }}</strong> of
                <strong>{{ staffs.paginator.count }}</strong> staff members
              </div>
              {% if staffs.has_other_pages %}
              <nav aria-label="Page navigation">
                <ul class="pagination pagination-sm m-0">
                  {% if staffs.has_previous %}
                  <li class="page-item">
                    <a class="page-link" href="?page=1" aria-label="First">
                      <span aria-hidden="true">&laquo;&laquo;</span>
                    </a>
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="?page={{ staffs.previous_page_number }}" aria-label="Previous">
                      <span aria-hidden="true">&laquo;</span>
                    </a>
                  </li>
                  {% endif %}

                  {% for i in staffs.paginator.page_range %}
                  {% if staffs.number == i %}
                  <li class="page-item active"><span class="page-link">{{ i }}</span></li>
                  {% elif i > staffs.number|add:'-3' and i < staffs.number|add:'3' %} <li class="page-item"><a
                      class="page-link" href="?page={{ i }}">{{ i }}</a></li>
                    {% endif %}
                    {% endfor %}

                    {% if staffs.has_next %}
                    <li class="page-item">
                      <a class="page-link" href="?page={{ staffs.next_page_number }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                      </a>
                    </li>
                    <li class="page-item">
                      <a class="page-link" href="?page={{ staffs.paginator.num_pages }}" aria-label="Last">
                        <span aria-hidden="true">&raquo;&raquo;</span>
                      </a>
                    </li>
                    {% endif %}
                </ul>
              </nav>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  /* Custom Styles */
  .bg-gradient-navy {
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%) !important;
  }

  .avatar-circle-sm {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    overflow: hidden;
    border: 2px solid #dee2e6;
  }

  .avatar-circle-sm img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .table-hover tbody tr:hover {
    background-color: rgba(0, 123, 255, 0.05) !important;
  }

  .table-striped tbody tr:nth-of-type(odd) {
    background-color: rgba(0, 0, 0, 0.02);
  }

  .btn-group .btn {
    margin-right: 5px;
    border-radius: 4px !important;
  }

  .avatar-circle-sm {
    width: 50px !important;
    height: 50px;
    border-radius: 50%;
    overflow: hidden;
    border: 2px solid #dee2e6;
  }

  .btn-group .btn:last-child {
    margin-right: 0;
  }

  .modal-content {
    border: none;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
  }

  .modal-header {
    border-bottom: none;
  }
</style>

<script>
  $(document).ready(function () {
    // Initialize tooltips
    $('[data-toggle="tooltip"]').tooltip();

    // Search functionality
    $('input[name="table_search"]').on('keyup', function () {
      var value = $(this).val().toLowerCase();
      $('table tbody tr').filter(function () {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
      });
    });
  });
</script>
<!-- /.content -->
{% endblock main_content %}